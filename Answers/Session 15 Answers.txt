--1. Fix the two encoding issues on quotes.txt
dos2unix quotes.txt
iconv -f Windows-1252 -t UTF-8 quotes.txt > quotes

--2. Import quotes into public.quote(quote varchar, said_by varchar, quote_ts).  Watch out for bad data.
CREATE TABLE Quotes_raw
(
	Quote varchar
);

COPY quotes_raw FROM '/vagrant/data/quotes' 


--Note that the – character is an en-dash not a hyphen.  You don't have a key on your keyboard to type it, but you can copy and paste it out of the data easily enough.
select trim(substring (quote from '^\d+\.\s*([^–]*)–.*$')) as quote, substring (quote from '^\d+\.\s*[^–]*–(.*)$') as said_by
into Quotes
from quotes_raw
where quote ~'^\d'

alter table quotes add quote_ts tsvector;

update quotes set quote_ts = to_tsvector('english', quote);

--3. Pull out the word frequency of the data in the table (one row per word showing the word and the number of occurences in any of the quotes).

select (regexp_matches(lower(quote), '[^\s\.]+','g'))[1], count(*)
from quotes
group by (regexp_matches(lower(quote), '[^\s\.]+','g'))[1]
order by 2 desc

--4. Find any quotes that reference 'life' using a text search
select *
from quotes 
where quote_ts @@ to_tsquery('english', 'life') 
order by 1 desc;

--5. Find any quotes that reference 'dreams' and rank them by match quality
select ts_rank(quote_ts, query), ts_rank_cd(quote_ts, query), *
from quotes, to_tsquery('english', 'dream') query
where quote_ts @@ query
order by 1 desc;


--6. Find any quotes that reference 'Dreams' and 'Big' and rank them by match quality.
select ts_rank(quote_ts, query), ts_rank_cd(quote_ts, query), *
from quotes, to_tsquery('english', 'dream&big') query
where quote_ts @@ query
order by 1 desc;

--7. Find any quotes that reference 'Dreams' or 'Big' and rank them by match quality.
select ts_rank(quote_ts, query), ts_rank_cd(quote_ts, query), *
from quotes, to_tsquery('english', 'dream|big') query
where quote_ts @@ query
order by 1 desc;

--8. Find any quotes that reference 'Dreams' and either 'Big' or 'bold' and rank them by match quality.
select ts_rank(quote_ts, query), ts_rank_cd(quote_ts, query), *
from quotes, to_tsquery('english', 'dream&(big|bold)') query
where quote_ts @@ query
order by 1 desc;

